<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ ClaudeCode_Remote - Launcher</title>
    <script src="/i18n.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
            text-align: center;
            position: relative;
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: #edf2f7;
            padding: 8px 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            border: 2px solid transparent;
        }

        .language-selector:hover {
            background: #e2e8f0;
            border-color: #667eea;
        }

        .language-selector .lang-icon {
            font-size: 18px;
        }

        h1 {
            font-size: 32px;
            color: #2d3748;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 16px;
            color: #718096;
            margin-bottom: 30px;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #d4edda;
            color: #155724;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .qr-section {
            background: #f7fafc;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .qr-code {
            background: white;
            padding: 20px;
            border-radius: 12px;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .qr-code img {
            display: block;
            width: 280px;
            height: 280px;
        }

        .qr-instruction {
            color: #4a5568;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .url-section {
            background: #edf2f7;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .url-text {
            flex: 1;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #2d3748;
            word-break: break-all;
            text-align: left;
            background: white;
            padding: 12px;
            border-radius: 8px;
        }

        .url-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .url-link:hover {
            text-decoration: underline;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-copy {
            background: #48bb78;
            min-width: 100px;
        }

        .btn-copy:hover {
            background: #38a169;
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }

        .btn-copy.copied {
            background: #2f855a;
        }

        .share-section {
            margin-bottom: 30px;
        }

        .share-title {
            font-size: 18px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 16px;
        }

        .share-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .btn-whatsapp {
            background: #25D366;
        }

        .btn-whatsapp:hover {
            background: #1ebd57;
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
        }

        .btn-messenger {
            background: #0084FF;
        }

        .btn-messenger:hover {
            background: #006de0;
            box-shadow: 0 4px 12px rgba(0, 132, 255, 0.4);
        }

        .btn-telegram {
            background: #0088cc;
        }

        .btn-telegram:hover {
            background: #006fa0;
            box-shadow: 0 4px 12px rgba(0, 136, 204, 0.4);
        }

        .btn-gmail {
            background: #EA4335;
        }

        .btn-gmail:hover {
            background: #d33426;
            box-shadow: 0 4px 12px rgba(234, 67, 53, 0.4);
        }

        .btn-mail {
            background: #5856d6;
        }

        .btn-mail:hover {
            background: #4645b8;
            box-shadow: 0 4px 12px rgba(88, 86, 214, 0.4);
        }

        .btn-sms {
            background: #34C759;
        }

        .btn-sms:hover {
            background: #2aa948;
            box-shadow: 0 4px 12px rgba(52, 199, 89, 0.4);
        }

        .btn-keep {
            background: #FFC107;
            color: #2d3748;
        }

        .btn-keep:hover {
            background: #FFA000;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4);
        }

        .btn-drive {
            background: #4285F4;
        }

        .btn-drive:hover {
            background: #3367D6;
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.4);
        }

        .btn-slack {
            background: #4A154B;
        }

        .btn-slack:hover {
            background: #350d36;
            box-shadow: 0 4px 12px rgba(74, 21, 75, 0.4);
        }

        .btn-discord {
            background: #5865F2;
        }

        .btn-discord:hover {
            background: #4752C4;
            box-shadow: 0 4px 12px rgba(88, 101, 242, 0.4);
        }

        .btn-teams {
            background: #6264A7;
        }

        .btn-teams:hover {
            background: #505293;
            box-shadow: 0 4px 12px rgba(98, 100, 167, 0.4);
        }

        .btn-twitter {
            background: #1DA1F2;
        }

        .btn-twitter:hover {
            background: #1a8cd8;
            box-shadow: 0 4px 12px rgba(29, 161, 242, 0.4);
        }

        .btn-linkedin {
            background: #0077B5;
        }

        .btn-linkedin:hover {
            background: #006399;
            box-shadow: 0 4px 12px rgba(0, 119, 181, 0.4);
        }

        .btn-notion {
            background: #2d2d2d;
        }

        .btn-notion:hover {
            background: #1a1a1a;
            box-shadow: 0 4px 12px rgba(45, 45, 45, 0.4);
        }

        .btn-download-qr {
            background: #8B5CF6;
        }

        .btn-download-qr:hover {
            background: #7C3AED;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        .danger-zone {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e2e8f0;
        }

        .btn-shutdown {
            background: #f56565;
            color: white;
        }

        .btn-shutdown:hover {
            background: #e53e3e;
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.4);
        }

        .footer {
            margin-top: 30px;
            color: #a0aec0;
            font-size: 12px;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #2d3748;
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        @media (max-width: 640px) {
            .container {
                padding: 24px;
            }

            h1 {
                font-size: 24px;
            }

            .qr-code img {
                width: 220px;
                height: 220px;
            }

            .share-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="language-selector" onclick="toggleLanguage()" title="Change language / Changer de langue">
            <span class="lang-icon" id="lang-flag">üá¨üáß</span>
            <span id="lang-name">English</span>
        </div>

        <h1 id="page-title">üöÄ ClaudeCode_Remote</h1>
        <p class="subtitle" id="page-subtitle">Votre serveur est pr√™t !</p>

        <div class="status">
            <span class="status-dot"></span>
            <span id="status-text">Serveur actif</span>
        </div>

        <div class="qr-section">
            <div class="qr-code" id="qrCodeContainer">
                <!-- QR Code sera ins√©r√© ici -->
            </div>
            <p class="qr-instruction" id="qr-instruction">üì± Scannez ce QR code avec votre t√©l√©phone</p>

            <div class="url-section">
                <div class="url-text">
                    <a href="#" id="tunnelUrl" class="url-link" target="_blank" data-i18n-loading>Chargement...</a>
                </div>
                <button class="btn btn-copy" id="copyBtn" onclick="copyUrl()">
                    <span id="copy-btn-text">üìã Copier</span>
                </button>
            </div>
        </div>

        <div class="share-section">
            <h3 class="share-title" id="share-title">üì§ Partager le lien</h3>
            <div class="share-buttons">
                <a href="#" class="btn btn-gmail" id="shareGmail" target="_blank">
                    üìß Gmail
                </a>
                <a href="#" class="btn btn-whatsapp" id="shareWhatsapp" target="_blank">
                    üí¨ WhatsApp
                </a>
                <a href="#" class="btn btn-messenger" id="shareMessenger" target="_blank">
                    üí¨ Messenger
                </a>
                <a href="#" class="btn btn-telegram" id="shareTelegram" target="_blank">
                    ‚úàÔ∏è Telegram
                </a>
                <a href="#" class="btn btn-sms" id="shareSMS">
                    üí¨ SMS
                </a>
                <a href="#" class="btn btn-mail" id="shareMail">
                    ‚úâÔ∏è Mail
                </a>
                <a href="#" class="btn btn-keep" id="shareKeep" target="_blank">
                    üìù Keep
                </a>
                <a href="#" class="btn btn-drive" id="shareDrive" target="_blank">
                    üìÑ Drive Doc
                </a>
                <a href="#" class="btn btn-slack" id="shareSlack" target="_blank">
                    üíº Slack
                </a>
                <a href="#" class="btn btn-discord" id="shareDiscord" target="_blank">
                    üéÆ Discord
                </a>
                <a href="#" class="btn btn-teams" id="shareTeams" target="_blank">
                    üë• Teams
                </a>
                <a href="#" class="btn btn-twitter" id="shareTwitter" target="_blank">
                    üê¶ Twitter
                </a>
                <a href="#" class="btn btn-linkedin" id="shareLinkedin" target="_blank">
                    üíº LinkedIn
                </a>
                <a href="#" class="btn btn-notion" id="shareNotion" onclick="shareToNotion(); return false;">
                    üìî Notion
                </a>
                <a href="#" class="btn btn-download-qr" id="downloadQR" onclick="downloadQRCode(); return false;">
                    ‚¨áÔ∏è QR Code
                </a>
            </div>
        </div>

        <div class="danger-zone">
            <button class="btn btn-shutdown" id="shutdown-btn" onclick="shutdownServer()">
                <span id="shutdown-btn-text">üõë Arr√™ter le serveur</span>
            </button>
        </div>

        <div class="footer" id="footer-version">
            ClaudeCode_Remote v1.1
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // R√©cup√©rer l'URL depuis les param√®tres de l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const tunnelUrl = urlParams.get('url') || window.location.origin;

        // Fonction pour mettre √† jour tous les textes traduits
        function updateTranslations() {
            const lang = window.i18n.getCurrentLanguage();

            // Mettre √† jour l'attribut lang du HTML
            document.documentElement.lang = lang;

            // Mettre √† jour le s√©lecteur de langue
            const altLang = window.i18n.getAlternativeLanguage();
            document.getElementById('lang-flag').textContent = altLang === 'en' ? 'üá¨üáß' : 'üá´üá∑';
            document.getElementById('lang-name').textContent = window.i18n.getAlternativeLanguageName();

            // Mettre √† jour les textes de la page
            document.getElementById('page-title').textContent = window.i18n.t('launcher.title');
            document.getElementById('page-subtitle').textContent = window.i18n.t('launcher.subtitle');
            document.getElementById('status-text').textContent = window.i18n.t('launcher.serverActive');
            document.getElementById('qr-instruction').textContent = window.i18n.t('launcher.scanQR');

            // URL loading text
            const urlLink = document.getElementById('tunnelUrl');
            if (urlLink.textContent === 'Chargement...' || urlLink.textContent === 'Loading...') {
                urlLink.textContent = window.i18n.t('launcher.loading');
            }

            document.getElementById('copy-btn-text').textContent = window.i18n.t('launcher.copyBtn');
            document.getElementById('share-title').textContent = window.i18n.t('launcher.shareTitle');
            document.getElementById('shutdown-btn-text').textContent = window.i18n.t('launcher.shutdownBtn');
            document.getElementById('footer-version').textContent = window.i18n.t('launcher.footerVersion');

            // Mettre √† jour les liens de partage avec les nouveaux messages
            updateShareLinks();
        }

        // Fonction pour basculer la langue
        function toggleLanguage() {
            window.i18n.toggleLanguage();
            updateTranslations();
        }

        // Fonction pour afficher un toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // G√©n√©rer le QR code
        function generateQRCode(url) {
            const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=280x280&data=${encodeURIComponent(url)}`;
            const img = document.createElement('img');
            img.src = qrApiUrl;
            img.alt = 'QR Code';
            document.getElementById('qrCodeContainer').appendChild(img);
        }

        // Fonction pour mettre √† jour les liens de partage
        function updateShareLinks() {
            const shareMessage = window.i18n.t('launcher.shareMessage', { url: tunnelUrl });
            const shareMessageEncoded = encodeURIComponent(shareMessage);
            const urlEncoded = encodeURIComponent(tunnelUrl);

            // Pr√©parer les messages
            const emailSubject = encodeURIComponent(window.i18n.t('launcher.emailSubject'));
            const emailBody = encodeURIComponent(window.i18n.t('launcher.emailBody', { url: tunnelUrl }));

            // Gmail
            document.getElementById('shareGmail').href = `https://mail.google.com/mail/?view=cm&fs=1&su=${emailSubject}&body=${emailBody}`;

            // WhatsApp
            document.getElementById('shareWhatsapp').href = `https://wa.me/?text=${shareMessageEncoded}`;

            // Messenger
            document.getElementById('shareMessenger').href = `fb-messenger://share/?link=${urlEncoded}`;

            // Telegram
            document.getElementById('shareTelegram').href = `https://t.me/share/url?url=${urlEncoded}&text=${encodeURIComponent('üöÄ Claude Code Remote')}`;

            // SMS
            document.getElementById('shareSMS').href = `sms:?&body=${shareMessageEncoded}`;

            // Mail (client mail par d√©faut)
            document.getElementById('shareMail').href = `mailto:?subject=${emailSubject}&body=${emailBody}`;

            // Google Keep - Cr√©er une note rapide
            const keepTitle = encodeURIComponent('üöÄ ClaudeCode_Remote');
            const keepText = encodeURIComponent(`Serveur ClaudeCode_Remote\n\nURL : ${tunnelUrl}\n\nDate : ${new Date().toLocaleDateString()}`);
            document.getElementById('shareKeep').href = `https://keep.google.com/u/0/#NOTE/title=${keepTitle}&text=${keepText}`;

            // Google Drive - Cr√©er un Google Doc
            const driveDocTitle = encodeURIComponent('ClaudeCode_Remote - Acc√®s');
            const driveDocContent = encodeURIComponent(`# ClaudeCode_Remote - Acc√®s au serveur\n\n## Informations de connexion\n\n**URL :** ${tunnelUrl}\n\n**Date de cr√©ation :** ${new Date().toLocaleString()}\n\n## Instructions\n\n1. Ouvrez l'URL ci-dessus sur votre t√©l√©phone\n2. Connectez-vous pour acc√©der au serveur\n3. Vous pourrez surveiller vos sessions Claude Code en temps r√©el\n\n---\n\n*G√©n√©r√© automatiquement par ClaudeCode_Remote*`);
            document.getElementById('shareDrive').href = `https://docs.google.com/document/create?title=${driveDocTitle}&body=${driveDocContent}`;

            // Slack - Partager dans un canal
            const slackMessage = encodeURIComponent(`üöÄ ClaudeCode_Remote\n${tunnelUrl}`);
            document.getElementById('shareSlack').href = `https://slack.com/intl/fr-fr/help/articles/201330256-Partager-des-liens-dans-Slack?text=${slackMessage}`;

            // Discord - Copier pour partager (Discord n'a pas d'API de partage direct)
            document.getElementById('shareDiscord').addEventListener('click', async (e) => {
                e.preventDefault();
                const discordMessage = `üöÄ **ClaudeCode_Remote**\n\n${tunnelUrl}\n\n*Serveur de monitoring Claude Code accessible √† distance*`;
                try {
                    await navigator.clipboard.writeText(discordMessage);
                    showToast(window.i18n.t('launcher.discordCopied'));
                } catch (err) {
                    showToast(window.i18n.t('launcher.copyError'));
                }
            });

            // Microsoft Teams - Partager un lien
            document.getElementById('shareTeams').href = `https://teams.microsoft.com/share?href=${urlEncoded}&msgText=${encodeURIComponent('üöÄ ClaudeCode_Remote - Acc√®s au serveur')}`;

            // Twitter/X - Partager publiquement
            const tweetText = encodeURIComponent(`üöÄ Monitoring mes sessions Claude Code √† distance avec ClaudeCode_Remote !`);
            document.getElementById('shareTwitter').href = `https://twitter.com/intent/tweet?text=${tweetText}&url=${urlEncoded}`;

            // LinkedIn - Partager sur le profil
            document.getElementById('shareLinkedin').href = `https://www.linkedin.com/sharing/share-offsite/?url=${urlEncoded}`;
        }

        // Copier l'URL dans le presse-papier
        async function copyUrl() {
            try {
                await navigator.clipboard.writeText(tunnelUrl);
                const btnText = document.getElementById('copy-btn-text');
                const originalText = btnText.textContent;
                btnText.textContent = window.i18n.t('launcher.copied');
                document.getElementById('copyBtn').classList.add('copied');
                showToast(window.i18n.t('launcher.urlCopied'));

                setTimeout(() => {
                    btnText.textContent = window.i18n.t('launcher.copyBtn');
                    document.getElementById('copyBtn').classList.remove('copied');
                }, 2000);
            } catch (err) {
                showToast(window.i18n.t('launcher.copyError'));
            }
        }

        // Partager vers Notion (copie un markdown format√©)
        async function shareToNotion() {
            const notionMarkdown = `# üöÄ ClaudeCode_Remote

## Acc√®s au serveur

**URL :** ${tunnelUrl}

**Date de cr√©ation :** ${new Date().toLocaleString()}

## Instructions

1. Ouvrez l'URL ci-dessus
2. Scannez le QR code avec votre t√©l√©phone
3. Acc√©dez √† votre serveur Claude Code √† distance

---

*G√©n√©r√© automatiquement par ClaudeCode_Remote*`;

            try {
                await navigator.clipboard.writeText(notionMarkdown);
                showToast(window.i18n.t('launcher.notionCopied'));
            } catch (err) {
                showToast(window.i18n.t('launcher.copyError'));
            }
        }

        // T√©l√©charger le QR code
        function downloadQRCode() {
            const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=${encodeURIComponent(tunnelUrl)}`;

            // Cr√©er un lien temporaire pour t√©l√©charger
            const link = document.createElement('a');
            link.href = qrApiUrl;
            link.download = `claude-code-remote-qr-${Date.now()}.png`;

            // D√©clencher le t√©l√©chargement
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showToast(window.i18n.t('launcher.qrDownload'));
        }

        // Arr√™ter le serveur
        async function shutdownServer() {
            if (!confirm(window.i18n.t('launcher.shutdownConfirm'))) {
                return;
            }

            try {
                showToast(window.i18n.t('launcher.shutdownInProgress'));

                const response = await fetch('/api/shutdown', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    showToast(window.i18n.t('launcher.shutdownSuccess'));

                    // Changer l'interface pour montrer que le serveur est arr√™t√©
                    setTimeout(() => {
                        document.querySelector('.status').innerHTML = `
                            <span style="width: 10px; height: 10px; background: #e53e3e; border-radius: 50%;"></span>
                            <span>${window.i18n.t('launcher.serverStopped')}</span>
                        `;
                        document.querySelector('.status').style.background = '#fed7d7';
                        document.querySelector('.status').style.color = '#9b2c2c';
                        document.body.innerHTML += `<div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999;"><div style="background: white; padding: 40px; border-radius: 16px; text-align: center;"><h2 style="color: #2d3748; margin-bottom: 16px;">${window.i18n.t('launcher.serverStoppedMessage')}</h2><p style="color: #718096;">${window.i18n.t('launcher.closeWindow')}</p></div></div>`;
                    }, 1000);
                } else {
                    showToast(window.i18n.t('launcher.shutdownError'));
                }
            } catch (err) {
                showToast(window.i18n.t('launcher.connectionError'));
            }
        }

        // Initialiser l'interface
        function initInterface() {
            // Afficher l'URL
            const urlElement = document.getElementById('tunnelUrl');
            urlElement.textContent = tunnelUrl;
            urlElement.href = tunnelUrl;

            // G√©n√©rer le QR code
            generateQRCode(tunnelUrl);

            // Initialiser les traductions
            updateTranslations();
        }

        // Initialiser au chargement de la page
        initInterface();
    </script>
</body>
</html>
